# KHUMU Comment API Server

**khumu-comment**ëŠ” MSAë¡œ ê°œë°œì¤‘ì¸ khumuì˜ comment ê´€ë ¨ APIë¥¼ ì œê³µí•˜ëŠ” ì„œë²„ì´ê³ , `Echo` ë¼ëŠ” Golangì˜ ì›¹í”„ë ˜ì›Œí¬ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê°œë°œë˜ê³  ìˆë‹¤. TDDì™€ Clean architectureë¥¼ ë°”íƒ•ìœ¼ë¡œ ê°œë°œì„ ì§„í–‰ ì¤‘ì´ë‹¤.

API Documentation: https://documenter.getpostman.com/view/13384984/TVsvfkxs

## âš™ï¸ì„¤ì •

`config/{{KHUMU_ENVIRONMENT}}.yaml` ì„ í†µí•´ í•„ìš”í•œ ì„¤ì •ì„ ì‘ì„±í•œë‹¤. KHUMU_ENVIRONMENTì˜ ê¸°ë³¸ê°’ì€ `default`ì´ë‹¤. ë”°ë¼ì„œ ê¸°ë³¸ì ìœ¼ë¡œëŠ” `config/default.yaml`ì„ ì„¤ì •ìœ¼ë¡œ ë¡œë“œí•œë‹¤.

`KHUMU_CONFIG_PATH` í™˜ê²½ë³€ìˆ˜ë¥¼ í†µí•´ `config` ì´ì™¸ì˜ config fileì´ ìœ„ì¹˜í•œ pathë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤. ë‹¨ìˆœíˆ ìƒëŒ€ ê²½ë¡œë¥¼ ì´ìš©í•˜ê¸°ì—ëŠ” test codeë¥¼ í†µí•œ í…ŒìŠ¤íŠ¸ ì‹œì— ìƒëŒ€ ê²½ë¡œê°€ ì˜¬ë°”ë¥´ê²Œ ì§€ì •ë˜ì§€ ëª»í•œë‹¤ëŠ” ì´ìŠˆê°€ ìˆë‹¤.
ë”°ë¼ì„œ ê°œë°œìë“¤ì˜ ê²½ìš° í¸ì˜ì— ë”°ë¼ ìì‹ ì˜ localì—ì„œì˜ config path ê²½ë¡œë¥¼ config íŒ¨í‚¤ì§€ì˜ `devKhumuConfigPath`ì— ì¶”ê°€í•˜ë„ë¡ í•œë‹¤.

`KHUMU_SECRET` í™˜ê²½ë³€ìˆ˜ë¥¼ í†µí•´ jwtë¥¼ verifyí•  secretì„ ì„¤ì •í•œë‹¤.

## ğŸ’¯ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ëŠ” ë°©ë²•

### í”„ë¡œì íŠ¸ ë‚´ì˜ ëª¨ë“  ìœ ë‹› í…ŒìŠ¤íŠ¸

í˜„ì¬ëŠ” Github Actionì—ì„œ ë§¤ í‘¸ì‹œë§ˆë‹¤ ìë™ìœ¼ë¡œ ì „ì²´ì— ëŒ€í•œ unit testë¥¼ ì§„í–‰í•˜ê³ ,
ì´ê²ƒì´ ëª¨ë‘ í†µê³¼í•˜ë©´ docker image ë¹Œë“œ í›„ private devops ë ˆí¬ì§€í† ë¦¬ì— ìƒˆ ë¹Œë“œë¥¼ ì ìš©ì‹œí‚¤ê³ ,
`ArgoCD` ë¥¼ í†µí•´ ìë™ ë°°í¬ê°€ ëœë‹¤.

```bash
# í”„ë¡œì íŠ¸ì˜ ë£¨íŠ¸ ê²½ë¡œì—ì„œ
$ go test ./...
# í˜¹ì€ ìì„¸í•œ ë¡œê·¸ë¥¼ ë³´ê³ ì‹¶ë‹¤ë©´
$ go test ./... -v
```

### TDD ì‹ì˜ ê°œë°œ ë°©ë²• - ì„  ìœ ë‹› í…ŒìŠ¤íŠ¸ ì‘ì„±. í›„ ê°œë°œ/ë¦¬íŒ©í† ë§ 

> testëŠ” MySQLì´ ì•„ë‹Œ SQLite3ë¥¼ ë©”ëª¨ë¦¬ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ ì´ìš©í•œë‹¤.

* ê°œë°œí•  ê¸°ëŠ¥ì— ëŒ€í•œ ìµœì†Œí•œì˜ ê¸°ëŠ¥ê³¼ ì‚¬ìš©í•˜ê³ ìí•˜ëŠ” íƒ€ì…, ë„¤ì´ë°ë“±ì„ ë¯¸ë¦¬ `xxx_test.go` íŒŒì¼ì— ì‘ì„±í•œë‹¤.
* í•´ë‹¹ ê¸°ëŠ¥ì„ `xxx.go` ì—ì„œ êµ¬í˜„í•œë‹¤.
* êµ¬í˜„í•´ë‚˜ê°€ë©´ì„œ ì•„ë˜ì˜ ì»¤ë§¨ë“œ ì½”ë“œë¥¼ í†µí•´ ìƒˆë¡œ êµ¬í˜„í•˜ëŠ” ë‚´ìš©ì— ëŒ€í•´ì„œë§Œ ê°„ë‹¨íˆ í…ŒìŠ¤íŠ¸ í•´ë³¸ë‹¤.
* êµ¬í˜„ì´ ëë‚˜ë©´ ì „ì²´ ìœ ë‹› í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•´ë³´ê³ , ì¢€ ë” ë‚˜ì€ ë°©í–¥ìœ¼ë¡œ ë¦¬íŒ©í† ë§í•œë‹¤.
* ë¦¬íŒ©í† ë§ì´ ì™„ë£Œë˜ë©´ ë‹¤ì‹œ ìƒˆë¡œìš´ ê¸°ëŠ¥ì— ëŒ€í•´ ìœ ë‹›í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•œë‹¤.

ì´ë ‡ê²Œ ìƒˆë¡œ êµ¬í˜„í•  ë‚´ìš©ì— ëŒ€í•œ ìœ ë‹›í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ê°œë°œì„ ì§„í–‰í•˜ë©´ ì „ì²´ ì„œë²„ë¥¼ ì¬ì‹¤í–‰í•˜ë©´ì„œ
ê°™ì€ ì‘ì—…ì„ ë°˜ë³µì ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ë¶ˆí¸ì„ ì—†ì•¨ ìˆ˜ ìˆê³ , í•œ ê¸°ëŠ¥ì— ëŒ€í•œ ì „ì²´ ê³„ì¸µì„ êµ¬í˜„í•˜ì§€ ì•Šì•„ë„
ê°œë°œí•˜ëŠ” ë™ì•ˆ ê° ê³„ì¸µë³„ë¡œ ë¯¸ë¦¬ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤.

**e.g.** _TDD ë°©ì‹ì„ ì´ìš©í•˜ì§€ ì•Šê³  ê°œë°œí•˜ë©´ ìš°ì„  `repository` ê³„ì¸µë§Œ ë¯¸ë¦¬ êµ¬í˜„í•˜ê³  í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ì€ë°, http ê³„ì¸µ
ê¹Œì§€ ë‹¤ êµ¬í˜„í•œ ë’¤ ì„œë²„ë¥¼ ë„ìš°ê³  ê·¸ ì—”ë“œí¬ì¸íŠ¸ì— ìš”ì²­ì„ ë³´ë‚´ê³  ë¡œê·¸ë¥¼ ê´€ì°°í•˜ë©° ê°œë°œì„ í•´ì•¼í•˜ì§€ë§Œ, TDDì™€ Unit testë¥¼
ì´ìš©í•´ ê°œë°œí•˜ë©´ unit testì˜ ê²°ê³¼ë§Œ ë³´ê³ ë„ ê°œë°œì´ ê°€ëŠ¥í•˜ë‹¤._

```bash
# ê°œë°œ ì¤‘ì¸ íŒŒì¼ì´ ì†í•œ íŒ¨í‚¤ì§€ì˜ ê²½ë¡œì— ëŒ€í•´ ì‹¤í–‰í•˜ê³ ìí•˜ëŠ” í•¨ìˆ˜ëª…ì„ ì „ë‹¬í•œë‹¤.
# ì´ë•Œ TestSetUpì—ì„œ Initialize ê´€ë ¨í•œ ë‚´ìš©ë„ í…ŒìŠ¤íŠ¸í•˜ë„ë¡ ì„¤ê³„í–ˆê¸°ë•Œë¬¸ì— TestSetUpë„ ê°™ì´ ì „ë‹¬í•œë‹¤.
$ go test ./repository/ -run TestSetUp TestLikeCommentRepositoryGorm_Create -v
```


## ğŸ“š ê°œë°œ íŒ ë° ë©”ëª¨

* go test ëŒ€ì‹  [gotest](https://github.com/rakyll/gotest)ë¥¼ ì´ìš©í•˜ë©´ ì¢€ ë” ê°€ì‹œì„± ì¢‹ê²Œ testë¥¼ ì§„í–‰í•  ìˆ˜ ìˆë‹¤.
* Jetbrainsì‚¬ì˜ GoLandë¥¼ ì´ìš©í•˜ë©´ IDEì—ì„œ ì¢€ ë” í¸ë¦¬í•˜ê²Œ ì›í•˜ëŠ” unit testë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.
* `{"message": "Not Found"}` ì‘ë‹µì„ ë°›ëŠ” ê²½ìš° `echo` ê°€ í•´ë‹¹ ê²½ë¡œì— ëŒ€í•´ route í•  ìˆ˜ ì—†ì„ ë•Œ ë°œìƒí•˜ëŠ”ë°, ì£¼ë¡œ ì£¼ì†Œì˜ ë§¨ ë `/` ì˜ ì°¨ì´ì¸ ê²½ìš°ê°€ ìˆì—ˆë‹¤. ì´ ë ˆí¬ì˜ ì»¨ë²¤ì…˜ì€ ë§¨ ë’¤ì— `/` ë¥¼ ì œê±°í•˜ëŠ” ê²ƒì„ ê¸°ë³¸ìœ¼ë¡œí•œë‹¤.


## ğŸš€ ê°œë°œ ë°©í–¥ì„± ë° ì›ì¹™

### 1. clean architectureë¥¼ ì ì ˆíˆ ì ìš©í•˜ì.

![khumu-comment-class-diagram.png](khumu-comment-class-diagram.png)

ê°€ì¥ ìƒìœ„ ê³„ì¸µë¶€í„° ê°€ì¥ í•˜ìœ„ ê³„ì¸µ, ê·¸ë¦¬ê³  ê³„ì¸µê³¼ ë…ë¦½ëœ configë‚˜ container ìˆœìœ¼ë¡œ ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤.

* **model**
  * khumuì˜ commentë¼ëŠ” ë„ë©”ì¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” ëª¨ë¸ì„ ì •ì˜í•©ë‹ˆë‹¤.
  * ì•„ë¬´ëŸ° ë‹¤ë¥¸ ê³„ì¸µë„ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ” ìµœìƒìœ„ ê³„ì¸µì…ë‹ˆë‹¤.
  * DB Tableì— í™œìš©ë˜ê±°ë‚˜ API Response í¬í•¨ë˜ëŠ” ë“± ë‹¤ì–‘í•˜ê²Œ ì‚¬ìš©ë  ìˆ˜ ìˆì§€ë§Œ, ì´ ê³„ì¸µì€ í•˜ìœ„ ê³„ì¸µë“¤ì´ ìì‹ ì„ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ì§€ ì „í˜€ ì•Œ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.
  * ìˆœìˆ˜í•˜ê²Œ ìš°ë¦¬ ë„ë©”ì¸ì˜ ì½”ë“œë¡œ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
* **usecase**
  * ëŒ€ë¶€ë¶„ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì´ê³³ì— ìœ„ì¹˜í•©ë‹ˆë‹¤.
    * e.g. ìµëª… ëŒ“ê¸€ì˜ ì‘ì„±ìê°€ ë³¸ì¸ì´ë©´ `is_author: true`ë¡œ ë³€í™˜
    * e.g. ë‹¨ìˆœí•œ array í˜•íƒœì˜ ëŒ“ê¸€ì„ children ëŒ“ê¸€ì„ í¬í•¨í•œ parent ëŒ“ê¸€ë“¤ì˜ arrayë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
    * e.g. ìµëª… ëŒ“ê¸€ì˜ ê²½ìš° ì‘ì„±ìì˜ usernameì™€ nicknameì„ ê°ì¶¥ë‹ˆë‹¤.
  * modelê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ìˆœìˆ˜ ìš°ë¦¬ ë„ë©”ì¸ì˜ ì½”ë“œë¡œ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
  * í•˜ìœ„ ê³„ì¸µì¸ repositoryì— ì˜ì¡´í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì˜ì¡´ì„± ì—­ì „ ì›ë¦¬(DIP)ì— ì˜í•´ í•˜ìœ„ ê³„ì¸µì˜ êµ¬í˜„ì²´ì— ì˜ì¡´í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì¶”ìƒì ì¸ repository interfaceì— ì˜ì¡´í•©ë‹ˆë‹¤.
  * usecaseê°€ ì˜ì¡´ì„± ì—­ì „ì´ ë˜ëŠ” ê²½ìš°ëŠ” ì•„ì§ ì—†ì§€ë§Œ, í•˜ìœ„ ê³„ì¸µì˜ testë¥¼ ìœ„í•´ mockì„ ì§€ì›í•´ì•¼í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— interfaceë¡œ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤.
* **repository**
  * ì™¸ë¶€ Data sourceì™€ ì§ì ‘ ì‘ì—…ì„ í•˜ëŠ” ê³„ì¸µì…ë‹ˆë‹¤. 
  * `interface`ì™€ ê·¸ì— ëŒ€í•œ êµ¬í˜„ì²´ë¥¼ ì •ì˜í•¨ìœ¼ë¡œì¨ ìœ ì—°í•˜ê²Œ ë™ì‘í•©ë‹ˆë‹¤. (ë‹¤í˜•ì„±ê³¼ ì˜ì¡´ì„± ì—­ì „)
    * `inferface`ë¥¼ ì •ì˜í•¨ìœ¼ë¡œì¨ `MySQL`, `SQLite3`, `Memory`ì˜ `array`ë‚˜ `map` ê·¸ ì–´ë–¤ ê±¸ ì‚¬ìš©í•˜ë“  ìœ ì—°í•˜ê²Œ ëŒ€ì²˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  * repositoryë¥¼ ì´ìš©í•˜ëŠ” ê³„ì¸µì€ ì§ì ‘ êµ¬í˜„ì²´ë¥¼ ì´ìš©í•˜ì§€ ì•Šê³  interfaceë§Œì„ ì´ìš©í•˜ê¸° ë•Œë¬¸ì— êµ¬í˜„ì²´ê°€ ë³€ê²½ë˜ì–´ë„ ì½”ë“œë¥¼ ë³€ê²½í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.
* **http**
  * ì£¼ë¡œ http í†µì‹  ìì²´ì— ëŒ€í•œ ë¡œì§ì„ ë‹´ê³ ìˆìŠµë‹ˆë‹¤. repositoryì™€ í•¨ê»˜ ê°€ì¥ í•˜ìœ„ ê³„ì¸µì…ë‹ˆë‹¤.
  * Router, Middleware, Authentication, Authorization ì™€ ê°™ì€ ì‘ì—…ì„ ë‹¤ë£¹ë‹ˆë‹¤.
  * `struct` => `json` ìœ¼ë¡œ `marshal` í•œ ë’¤ ê·¸ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ Responseë¥¼ êµ¬ì„±í•˜ëŠ” ë¡œì§ì„ ë‹´ê¸°ë„ í•©ë‹ˆë‹¤.
    (e.g. `Comment` structë¥¼ ë°›ì•„ì„œ jsonìœ¼ë¡œ ë³€í™˜í•œ ë’¤ Responseì˜ bodyë¥¼ ì‘ì„±í•˜ëŠ” ì‘ì—…ì„ ì§„í–‰í•©ë‹ˆë‹¤.   
* ì£¼ë¡œ ìš”ì²­ì— ëŒ€í•œ ì‘ì—…ì„ usecaseë¥¼ í†µí•´ ì§„í–‰í•©ë‹ˆë‹¤.
* **container**
  * ì»¨í…Œì´ë„ˆëŠ” ìœ„ì˜ ëª¨ë“  ê³„ì¸µë“¤ê³¼ ë‹¬ë¦¬ ìƒìœ„ ê³„ì¸µ, í•˜ìœ„ ê³„ì¸µì˜ ê°œë…ì„ ê°–ì§€ ì•Šê³  ì˜ì¡´ì„± ì£¼ì…ì„ ê´€ë¦¬í•´ì¤ë‹ˆë‹¤.
    * ê°œë°œìëŠ” ìˆ˜ì‘ì—…ìœ¼ë¡œ ì˜ì¡´ì„±ì„ ì£¼ì…í•´ì£¼ê±°ë‚˜, structë¥¼ ìƒì„±í•  í•„ìš” ì—†ì´ containerê°€ typeì„ ê¸°ë°˜ìœ¼ë¡œ ìì‹ (container)ì— í•´ë‹¹ íƒ€ì…ì˜ ë³€ìˆ˜ê°€ ì¡´ì¬í•˜ë©´
      ê·¸ê²ƒì„ ì´ìš©í•  ìˆ˜ ìˆê²Œí•´ì£¼ê³ , ì—†ë‹¤ë©´ ìƒì„±í•œ ë’¤ ì´ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.
  * DI frameworkì¸ digê°€ ì˜ì¡´ì„± ì£¼ì…ì„ ì œì–´í•œë‹¤ëŠ” ë©´ì—ì„œ IoC(ì œì–´ì˜ ì—­ì „)ì´ ë°œìƒí•©ë‹ˆë‹¤.
    * í˜„ì¬ëŠ” uberì˜ `dig` íŒ¨í‚¤ì§€ë¥¼ ì˜ì¡´ì„± ì£¼ì… íŒ¨í‚¤ì§€ë¡œ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤. êµ¬ê¸€ì˜ `wire` ê°€ ê½¤ ìœ ëª…í•œ ê²ƒ ê°™ì§€ë§Œ, ê°€ë…ì„±ì„ í•´ì¹  ê²ƒ ê°™ê³ , ìœ ì—°í•˜ì§€ ì•Šì€ ë“¯í•˜ì—¬ ë°°ì œí–ˆìŠµë‹ˆë‹¤.
      uberì˜ `fx` ëŠ” `dig` ë¥¼ í•œ ë‹¨ê³„ ë” ê°ì‹¼ íŒ¨í‚¤ì§€ì¸ë“¯í•œë°, ë§ˆì°¬ê°€ì§€ë¡œ ìœ ì—°ì„±ì´ ë–¨ì–´ì§€ëŠ” ëŠë‚Œì„ ë°›ì•˜ìŠµë‹ˆë‹¤. 
  * IoC Containerì™€ ê´€ë ¨ëœ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” íŒ¨í‚¤ì§€ì…ë‹ˆë‹¤.
* **config** : í”„ë¡œê·¸ë¨ì— ëŒ€í•œ ì„¤ì • ì •ë³´ë‚˜ ê·¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì‘ì—…ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.

### 2. TDD(Test Driven Development)ë¥¼ í†µí•´ ê°œë°œí•˜ì.

* í° ì¥ì ë“¤
  * ì§€ì†ì ì¸ ê°œë°œì— ëŒ€í•œ ì‹ ë¢°ì™€ ì•ˆì •ì„±ì´ ìƒìŠ¹í•˜ê³ , ì´ëŠ” ìƒì‚°ì„±ìœ¼ë¡œë„ ì—°ê²°ëœë‹¤.
  * ë˜í•œ ë‹¹ì¥ì˜ ê°œë°œì—ì„œë„ unit testë¥¼ í†µí•´ ê³„ì¸µì„ ë‚˜ëˆ„ì–´ ê°œë°œí•˜ê¸° í¸ë¦¬í•˜ê²Œ ë•Œë¬¸ì— ìƒì‚°ì„±ì´ ì¦ê°€ëœë‹¤.

* ì›ë˜ëŠ” ì˜ì¡´ì„± ì£¼ì… íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ëŠ”ë°, test codeë¥¼ ì§œê²Œ ë˜ë©´ì„œ ìˆ˜ë™ìœ¼ë¡œ ì˜ì¡´ì„±ì„ ë„£ëŠ” ê²ƒì´ ë²ˆê±°ë¡­ê¸°ë„ í•˜ê³  ê°€ë…ì„±ë„ ì•ˆ ì¢‹ì€ ê²ƒ ê°™ì•„
  ì˜ì¡´ì„± ì£¼ì… íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ê¸° ì‹œì‘í–ˆë‹¤.
  
* Mocking í•˜ëŠ” ê²½ìš°
  * struct í˜• ì¸ìê°€ ì•„ë‹Œ interface í˜• ì¸ìë¥¼ ì´ìš©í•˜ë©´ ì˜ì¡´ì„±ì„ ì£¼ì…í•  ë•Œ mock typeì„ ì£¼ì…í•  ìˆ˜ ìˆë‹¤.
  * mock typeì„ ì´ìš©í•˜ë©´ í•˜ìœ„ ê³„ì¸µì˜ ë‚´ìš©ê³¼ ë…ë¦½ë˜ê²Œ í•´ë‹¹ ê³„ì¸µë§Œ í…ŒìŠ¤íŠ¸ í•  ìˆ˜ ìˆë‹¤.
  * mock typeì„ ì´ìš©í•˜ë©´ í•˜ìœ„ ê³„ì¸µì˜ í•˜ìœ„ ê³„ì¸µì— ëŒ€í•œ ì˜ì¡´ì„±, ê·¸ í•˜ìœ„ ê³„ì¸µì˜ ë” í•˜ìœ„ ê³„ì¸µì— ëŒ€í•œ ì˜ì¡´ì„±ì„ ëª¨ë‘ ì£¼ì…í•´ ì¤„ í•„ìš” ì—†ì´
    ë‚´ê°€ ì§ì ‘ í•„ìš”í•œ ê³„ì¸µë§Œ ì£¼ì…í•˜ë©´ ëœë‹¤ëŠ” ì ì´ í¸ë¦¬í•˜ë‹¤.
  * ë‹¤ë§Œ í•˜ìœ„ ê³„ì¸µì„ í‰ë‚´ëƒˆë‹¤ëŠ” ì ì—ì„œ ì‹¤ì œ í•˜ìœ„ ê³„ì¸µì˜ ë™ì‘ê³¼ ë‹¤ë¥´ê²Œ ë™ì‘í•  ìˆ˜ ìˆë‹¤ëŠ” ë©´ì´ í•´ë‹¹ ê³„ì¸µì˜ í…ŒìŠ¤íŠ¸ì˜ ì •í™•ì„±ì„
    ë‚®ì¶œ ìˆ˜ ìˆë‹¤.
  * ì˜ì¡´ì„±ì„ ì£¼ì…í•˜ëŠ” ê²ƒì´ ì˜¤íˆë ¤ mock methodsë¥¼ ì •ì˜í•˜ëŠ” ê²ƒë³´ë‹¤ í¸ë¦¬í•œ ê²½ìš°ë„ ë§ë‹¤.  
  
* ê° Test ë³„ ë…ë¦½ì„±ì´ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë„ë¡ í•˜ì.

  * Java Springì˜ BeforeEachì™€ AfterEachì—ì„œ ì•„ì´ë””ì–´ë¥¼ ì–»ì–´ `B`ì™€ `A`ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ê¸°ë¡œ í–ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ ì´ˆê¸° ë°ì´í„°ê°€ í•„ìš”í•œ í…ŒìŠ¤íŠ¸ë“¤ì€ ëª¨ë‘ ì•„ë˜ì™€ ê°™ì´ Bì™€ Aë¥¼ ì´ìš©í•´ Set upê³¼ clean upì„ ì§„í–‰í•œë‹¤.

    ```go
    func TestFoo(t *testing.T) {
        B()
        defer A()
        // some test scenarios.
    }
    ```

  * `github.com/khu-dev/khumu-comment/test`  íŒ¨í‚¤ì§€ì— ì´ˆê¸° ë°ì´í„° í˜•ì‹ê³¼ í•„ìš”í•œ ëª‡ ê°€ì§€ í•¨ìˆ˜ë¥¼ ì •ì˜í•´ë†“ì•˜ë‹¤.



## ğŸ“š Golang ê°œë°œ ì´ì•¼ê¸°

### `embedding` ì„ í†µí•œ ì˜ì¡´ì„± ì£¼ì…í•  íƒ€ì… ì •ì˜í•˜ê¸°

typeì„ ê¸°ë°˜ìœ¼ë¡œ ì˜ì¡´ì„± ì£¼ì…ì„ ìë™í™”í•˜ëŠ” ì˜ì¡´ì„± ì£¼ì… íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°
ë™ì¼ íƒ€ì…ì´ì§€ë§Œ ë‹¤ë¥¸ ê°ì²´ë¥¼ ì£¼ì…í•˜ê³  ì‹¶ì€ ê²½ìš° ë‚œê°í•œ ê²½ìš°ê°€ ìˆë‹¤. ì´ëŸ° ê²½ìš°ì—ëŠ” `embedding` ì„ í†µí•´ ì›ë˜ íƒ€ì…ì˜
ë©”ì†Œë“œì™€ í•„ë“œë¥¼ ëª¨ë‘ ì‚¬ìš©í•˜ë©´ì„œ ê°œë³„ì ì¸ typeìœ¼ë¡œ ì´ìš©í•  ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ routerì—ì„œëŠ” ìì‹ router groupì€ parent router groupì„
ì¸ìë¡œ ë°›ê³ ì‹¶ì€ë°, ê·¸ëƒ¥ `*echo.Group` ì„ ì£¼ì…ë°›ê² ë‹¤ê³  ì •ì˜í•˜ë©´, ì–´ë–¤ `*echo.Group` ì„ ì£¼ì…ë°›ê²Œ ë  ì§€ ëª¨ë¥¸ë‹¤. ë”°ë¼ì„œ ì•„ë˜ì™€ ê°™ì´
`embedding` ì„ í†µí•´ ì›ë˜ì˜ ë©”ì†Œë“œì™€ í•„ë“œë¥¼ ëª¨ë‘ ì‚¬ìš©í•˜ë©´ì„œ ì£¼ì…ë°›ì„ ìƒˆë¡œìš´ íƒ€ì…ì„ ì •ì˜í•  ìˆ˜ ìˆë‹¤.

```go
// embeddingì„ í†µí•´ *echo.Groupì˜ ë©”ì†Œë“œ, í•„ë“œë¥¼ ì´ìš©í•  ìˆ˜ ìˆëŠ” íƒ€ì… ì •ì˜
// ì´ íƒ€ì…ì„ ì¸ìë¡œ ë°›ëŠ” ë©”ì†Œë“œëŠ” ì¼ë°˜ì ì¸ *echo.Group íƒ€ì…ê³¼ êµ¬ë³„ëœ RootRouter Typeì„ ì´ìš©í•  ìˆ˜ ìˆë‹¤.
type RootRouter struct{*echo.Group}

func NewRootRouter(echoServer *echo.Echo, ... ì¸ì ìƒëµ) *RootRouter{
    g := RootRouter{Group: echoServer.Group("/api")}
    //... ì‘ì—… ìƒëµ
    return &g
}

func NewCommentRouter(root *RootRouter, ... ì¸ì ìƒëµ) *CommentRouter {
    // íŠ¹ì´í•˜ê²Œ Typeëª…ê³¼ ì´ìš©í•˜ê³ ìí•˜ëŠ” ë©”ì†Œë“œ ëª…ì´ ê°™ì•„ì„œ ì´ë ‡ê²Œ ì‚¬ìš©í•  ë¿ ì›ë˜ëŠ” embed ì‹œ root.Group("/comments")ë¡œ ì‚¬ìš© ê°€ëŠ¥ 
    group := root.Group.Group("/comments") 
    commentRouter := &CommentRouter{group, ... ì¸ì ìƒëµ}
    return commentRouter
}
```

### `interface` ë¥¼ í†µí•´ mock typeì„ ì´ìš©í•˜ì—¬ ì˜ì¡´ì„± ì£¼ì…ì´ í•„ìš” ì—†ëŠ” í…ŒìŠ¤íŠ¸í•˜ê¸°

`http` ê³„ì¸µì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì§ ë‹¤ê³  ê°€ì •í•˜ì. `http`ëŠ” `usecase` ê³„ì¸µì— ì˜ì¡´ì ì´ë‹¤.
ê·¸ëŸ¼ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì§¤ ë•Œ `http` ìƒì„± ì‹œ `usecase` ë¥¼ ìƒì„±í•˜ì—¬ ì£¼ì…ì‹œì¼œì£¼ì–´ì•¼í•œë‹¤. ê·¼ë° ë°˜ë³µì ìœ¼ë¡œ
`usecase` ëŠ” `repository` ì— ì˜ì¡´ì ì´ë¯€ë¡œ `repository` ë¥¼ ìƒì„±í•˜ì—¬ ì£¼ì…ë°›ì•„ì•¼í•œë‹¤. ë”°ë¼ì„œ ì´ëŸ¬í•œ
ì˜ì¡´ íŒŒì´í”„ë¼ì¸ì„ ë§Œì¡±ì‹œì¼œì£¼ê¸° ë²ˆê±°ë¡­ê¸°ë•Œë¬¸ì— mock typeì„ ì´ìš©í•´ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê³ ì‹¶ë‹¤.

ë§Œì•½ ì•„ë˜ì™€ ê°™ì€ ì½”ë“œì—ì„œ CommentUseCaseì— ê´€í•œ mock typeì„ ì •ì˜í•œë‹¤ë©´ ì‚¬ìš©ì´ ê°€ëŠ¥í• ê¹Œ?

```go
func NewCommentRouter(root *RootRouter, uc CommentUseCaseStruct) *CommentRouter {
    ... ì‘ì—… ìƒëµ
    return commentRouter
}
```

mock typeì„ ì´ìš©í•˜ê¸° ë¶ˆê°€ëŠ¥í•˜ë‹¤. ì´ìœ ëŠ” CommentUseCase ì—­í• ì„ í•˜ëŠ” ì¸ìê°€ struct íƒ€ì…ìœ¼ë¡œ ì •ì˜ë˜ì–´ìˆê¸° ë•Œë¬¸ì´ë‹¤.
mock typeì„ ì •ì˜í•œë‹¤ê³  í•´ë„ ê·¸ typeì€ ìœ„ì— ì •ì˜ëœ `CommentUseCaseStruct` typeì´ ë  ìˆ˜ ì—†ë‹¤.

ë”°ë¼ì„œ ì£¼ì…ë°›ëŠ” ì¸ìì˜ typeì„ concreteí•œ structê°€ ì•„ë‹Œ abstractí•œ interfaceë¡œ ì •ì˜í•´ì£¼ë©´ ëœë‹¤.
ì•„ë˜ì²˜ëŸ¼ mock typeì´ í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ê°€ ë˜ê¸° ìœ„í•œ ë©”ì†Œë“œë“¤ë§Œ í•„ìš”í•œ ë§Œí¼ë§Œ ì›ë˜ íƒ€ì…ì„ í‰ë‚´ë‚´ì–´ êµ¬í˜„í•´ì£¼ë©´ëœë‹¤.

```go
type CommentUseCaseInterface interface{
    List() []*model.Comment
}
type CommentUseCaseMock struct{}

// ê°„ë‹¨í•˜ê²Œ í•„ìš”í•œ ë§Œí¼ë§Œ ì›ë˜ì˜ ê¸°ëŠ¥ì„ í‰ë‚´ë‚¸ë‹¤.
func (uc *CommentUseCaseMock) List []*model.Comment{
    return []*model.Comment{
        &model.Comment{...ìƒëµ}, &model.Comment{...ìƒëµ}, &model.Comment{...ìƒëµ}
    }
}

// ì£¼ì…ë°›ëŠ” ì¸ìì˜ íƒ€ì…ì„ interfaceí˜•ìœ¼ë¡œ ì •ì˜í–ˆê¸°ë•Œë¬¸ì— ì‹¤ì œì ì¸ CommentUseCaseì´ë“  ê°€ì§œì˜ CommentUseCaseMock íƒ€ì…ì´ë“ 
// ìƒê´€ ì—†ì´ ì£¼ì…ë°›ì„ ìˆ˜ ìˆë‹¤.
// ì„œë²„ë¥¼ ëŒë¦´ ë•Œì—ëŠ” CommentUseCaseë¥¼, í…ŒìŠ¤íŠ¸ í•  ë•ŒëŠ” ì˜ì¡´ì„± ì£¼ì…ì´ í¸ë¦¬í•œ CommentUseCaseMockì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
func NewCommentRouter(root *RootRouter, uc CommentUseCaseInterface) *CommentRouter {
    ... ì‘ì—… ìƒëµ
    return commentRouter
}
```

## How to contribute

microserviceë¡œ ì§„í–‰ë˜ëŠ” í”„ë¡œì íŠ¸ì´ë©° ì•„ì§ localì—ì„œ ì™„ì „íˆ comment ì„œë²„ë§Œì„ ëŒë¦¬ê¸° ìœ„í•œ ì´ˆê¸° í™˜ê²½ êµ¬ì¶•ì€ ì§€ì›ë˜ì§€ ì•Šê³  ìˆê¸° ë•Œë¬¸ì— ê¸°ì—¬ëŠ” ì‰½ì§€ ì•Šì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤.


---

## Gorm => Entgo ì ìš© ì¤‘

```shell
# Commentë¼ëŠ” Tableì„ ì •ì˜í•˜ê¸° ìœ„í•œ ì´ˆì•ˆ
$ go run entgo.io/ent/cmd/ent init Comment
# Comment í…Œì´ë¸” ìˆ˜ì • í›„ ê·¸ì— ë§ëŠ” ê¸°ëŠ¥ì˜ ì½”ë“œ ìƒì„±
$ go generate ./ent
```